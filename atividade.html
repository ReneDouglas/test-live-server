<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Municípios por Estado - IBGE</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    select {
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
    }

    table {
      border-collapse: collapse;
      width: 90%;
      background-color: white;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #4CAF50;
      color: white;
    }

    tbody tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    .loading {
      font-size: 18px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Consulta de Municípios por Estado</h1>

  <select id="estadoSelect">
    <option value="">Selecione um estado...</option>
  </select>

  <div id="loading" class="loading"></div>

  <table id="municipiosTable">
    <thead>
      <tr>
        <th>Nome da Cidade</th>
        <th>Microrregião</th>
        <th>Mesorregião</th>
        <th>Região</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const estadoSelect = document.getElementById("estadoSelect");
    const tabelaBody = document.querySelector("#municipiosTable tbody");
    const loading = document.getElementById("loading");

    // ------------------ Método 1: fetch para obter os estados ------------------ //
    window.addEventListener("DOMContentLoaded", () => {
      fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome")
        .then(response => response.json())
        .then(estados => {
          estados.forEach(estado => {
            const option = document.createElement("option");
            option.value = estado.sigla;
            option.textContent = estado.nome;
            estadoSelect.appendChild(option);
          });
        })
        .catch(error => {
          alert("Erro ao carregar os estados.");
          console.error(error);
        });
    });

    // ------------------ Método 2: XMLHttpRequest para obter os municípios ------------------ //
    estadoSelect.addEventListener("change", () => {
      const sigla = estadoSelect.value;
      if (!sigla) return;

      tabelaBody.innerHTML = "";
      loading.textContent = "Carregando municípios...";

      const xhr = new XMLHttpRequest();
      xhr.open("GET", `https://servicodados.ibge.gov.br/api/v1/localidades/estados/${sigla}/municipios`);
      xhr.onload = () => {
        if (xhr.status === 200) {
          const municipios = JSON.parse(xhr.responseText);
          municipios.forEach(mun => {
            const linha = document.createElement("tr");

            const nome = mun.nome;
            const microrregiao = mun.microrregiao?.nome || "-";
            const mesorregiao = mun.microrregiao?.mesorregiao?.nome || "-";
            const regiao = mun.microrregiao?.mesorregiao?.UF?.regiao?.nome || "-";

            linha.innerHTML = `
              <td>${nome}</td>
              <td>${microrregiao}</td>
              <td>${mesorregiao}</td>
              <td>${regiao}</td>
            `;
            tabelaBody.appendChild(linha);
          });
          loading.textContent = "";
        } else {
          loading.textContent = "Erro ao carregar municípios.";
        }
      };
      xhr.onerror = () => {
        loading.textContent = "Erro de conexão.";
      };
      xhr.send();
    });
  </script>
</body>
</html>
